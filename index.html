<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life360 - Pelacak Lokasi Keluarga</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        * { font-family: 'Roboto Slab', serif; }
        :root { --primary-color: #8CA9FF; --primary-dark: #6B8EE8; --bg-color: #f8f9fa; }
        body { background-color: var(--bg-color); overflow-x: hidden; }
        
        /* Auth Styles */
        .auth-container { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%); }
        .auth-card { background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.1); padding: 40px; max-width: 450px; width: 100%; }
        
        /* Map Styles */
        #mapContainer { height: 500px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1; }
        
        /* UI Components */
        .member-card { background: white; border-radius: 15px; padding: 15px; margin-bottom: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .member-avatar { width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; }
        .battery-indicator { padding: 2px 8px; border-radius: 5px; font-size: 0.75rem; }
        .battery-high { background: #d4edda; color: #155724; }
        .battery-low { background: #f8d7da; color: #721c24; }
        
        /* SOS & Chat */
        .sos-button { position: fixed; bottom: 30px; right: 30px; width: 70px; height: 70px; border-radius: 50%; background: #dc3545; color: white; border: none; font-size: 24px; box-shadow: 0 5px 20px rgba(220,53,69,0.4); animation: pulse 2s infinite; z-index: 1000; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .chat-container { height: 350px; overflow-y: auto; background: #f1f3f6; padding: 15px; border-radius: 10px; }
        .message { margin-bottom: 10px; padding: 8px 12px; border-radius: 10px; max-width: 80%; }
        .message.sent { background: var(--primary-color); color: white; margin-left: auto; }
        .message.received { background: white; color: #333; }
    </style>
</head>
<body>

    <div id="authContainer" class="auth-container">
        <div id="loginForm" class="auth-card">
            <div class="text-center mb-4">
                <i class="fas fa-map-marked-alt fa-3x text-primary"></i>
                <h2 class="mt-2">Life360</h2>
            </div>
            <form id="formLogin">
                <div class="mb-3"><label>Email</label><input type="email" id="loginEmail" class="form-control" required value="user@example.com"></div>
                <div class="mb-3"><label>Password</label><input type="password" id="loginPassword" class="form-control" required value="password123"></div>
                <button type="submit" class="btn btn-primary w-100">Masuk</button>
                <p class="text-center mt-3">Belum punya akun? <a href="#" id="showRegister">Daftar</a></p>
            </form>
        </div>

        <div id="registerForm" class="auth-card" style="display: none;">
            <h2 class="text-center">Daftar</h2>
            <form id="formRegister">
                <div class="mb-3"><label>Nama Lengkap</label><input type="text" id="regName" class="form-control" required></div>
                <div class="mb-3"><label>Email</label><input type="email" id="regEmail" class="form-control" required></div>
                <div class="mb-3"><label>Password</label><input type="password" id="regPassword" class="form-control" required></div>
                <button type="submit" class="btn btn-primary w-100">Daftar</button>
                <p class="text-center mt-3">Sudah punya akun? <a href="#" id="showLogin">Masuk</a></p>
            </form>
        </div>
    </div>

    <div id="mainApp" style="display: none;">
        <nav class="navbar navbar-dark bg-primary mb-4">
            <div class="container">
                <span class="navbar-brand mb-0 h1"><i class="fas fa-street-view"></i> Life360</span>
                <div class="text-white">
                    Halo, <span id="userNameDisplay"></span>
                    <button class="btn btn-outline-light btn-sm ms-3" id="logoutBtn">Keluar</button>
                </div>
            </div>
        </nav>

        <div class="container">
            <ul class="nav nav-tabs mb-4" id="appTabs">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#map-pane">Peta</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#chat-pane">Chat</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#history-pane">Riwayat</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#settings-pane">Pengaturan</button></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="map-pane">
                    <div class="row">
                        <div class="col-md-8">
                            <div id="mapContainer"></div>
                        </div>
                        <div class="col-md-4">
                            <h5>Anggota Lingkaran</h5>
                            <div id="membersList"></div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="chat-pane">
                    <div class="card p-3">
                        <div id="chatMessages" class="chat-container mb-3"></div>
                        <div class="input-group">
                            <input type="text" id="chatInput" class="form-control" placeholder="Tulis pesan...">
                            <button class="btn btn-primary" id="sendMessage"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="history-pane">
                    <div class="card p-3">
                        <h5>Aktivitas Terkini</h5>
                        <div id="historyList"></div>
                    </div>
                </div>

                <div class="tab-pane fade" id="settings-pane">
                    <div class="card p-3">
                        <h5>Privasi & Keamanan</h5>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" checked>
                            <label class="form-check-label">Bagikan Lokasi Real-time</label>
                        </div>
                        <button class="btn btn-danger" id="btnSOS">Simulasi SOS Darurat</button>
                    </div>
                </div>
            </div>
        </div>

        <button class="sos-button" id="mainSOS"><i class="fas fa-bell"></i></button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Data Dummy
        let members = [
            { id: 1, name: 'Ayah', lat: -6.2088, lng: 106.8456, battery: 90, color: '#4CAF50' },
            { id: 2, name: 'Ibu', lat: -6.2100, lng: 106.8400, battery: 45, color: '#FF9800' },
            { id: 3, name: 'Adik', lat: -6.2150, lng: 106.8500, battery: 15, color: '#F44336' }
        ];

        let map, markers = {};

        // Auth Logic
        document.getElementById('formLogin').onsubmit = (e) => {
            e.preventDefault();
            document.getElementById('authContainer').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            document.getElementById('userNameDisplay').innerText = "User Demo";
            initMap();
            renderUI();
        };

        document.getElementById('logoutBtn').onclick = () => location.reload();

        // Switch Auth Forms
        document.getElementById('showRegister').onclick = () => {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        };
        document.getElementById('showLogin').onclick = () => {
            document.getElementById('registerForm').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
        };

        // Initialize Leaflet Map
        function initMap() {
            if (map) return;
            // Center ke Jakarta
            map = L.map('mapContainer').setView([-6.2088, 106.8456], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

            updateMarkers();
        }

        function updateMarkers() {
            members.forEach(m => {
                if (markers[m.id]) map.removeLayer(markers[m.id]);
                
                const icon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div style="background:${m.color}; width:30px; height:30px; border-radius:50%; border:3px solid white; display:flex; align-items:center; justify-content:center; color:white; font-size:12px; font-weight:bold; box-shadow:0 2px 5px rgba(0,0,0,0.3)">${m.name[0]}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });

                markers[m.id] = L.marker([m.lat, m.lng], { icon: icon })
                    .addTo(map)
                    .bindPopup(`<b>${m.name}</b><br>Baterai: ${m.battery}%`);
            });
        }

        // Render Members & History
        function renderUI() {
            const list = document.getElementById('membersList');
            list.innerHTML = members.map(m => `
                <div class="member-card d-flex align-items-center" onclick="map.panTo([${m.lat}, ${m.lng}])" style="cursor:pointer">
                    <div class="member-avatar" style="background:${m.color}">${m.name[0]}</div>
                    <div class="ms-3 flex-grow-1">
                        <div class="fw-bold">${m.name}</div>
                        <small class="text-muted">Terlihat 1 menit lalu</small>
                    </div>
                    <span class="battery-indicator ${m.battery > 20 ? 'battery-high' : 'battery-low'}">
                        <i class="fas fa-battery-half"></i> ${m.battery}%
                    </span>
                </div>
            `).join('');

            const history = document.getElementById('historyList');
            history.innerHTML = `
                <div class="list-group">
                    <div class="list-group-item"><i class="fas fa-home text-success"></i> Ayah sampai di <b>Rumah</b> <small class="text-muted float-end">10:30</small></div>
                    <div class="list-group-item"><i class="fas fa-school text-primary"></i> Adik meninggalkan <b>Sekolah</b> <small class="text-muted float-end">14:00</small></div>
                    <div class="list-group-item"><i class="fas fa-shopping-cart text-warning"></i> Ibu tiba di <b>Supermarket</b> <small class="text-muted float-end">15:15</small></div>
                </div>
            `;
        }

        // Simple Chat Logic
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        
        document.getElementById('sendMessage').onclick = () => {
            if (!chatInput.value) return;
            const msg = chatInput.value;
            chatMessages.innerHTML += `<div class="message sent">${msg}</div>`;
            chatInput.value = '';
            chatMessages.scrollTop = chatMessages.scrollHeight;

            // Bot response simulasi
            setTimeout(() => {
                chatMessages.innerHTML += `<div class="message received">Oke, hati-hati di jalan ya!</div>`;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 1000);
        };

        // SOS Logic
        const triggerSOS = () => {
            alert('ðŸš¨ SOS AKTIF! Lokasi Anda telah dikirim ke semua anggota keluarga dan layanan darurat.');
            console.log("SOS sended from:", map.getCenter());
        };

        document.getElementById('mainSOS').onclick = triggerSOS;
        document.getElementById('btnSOS').onclick = triggerSOS;

        // Fix Leaflet resize bug on tab switch
        document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(el => {
            el.addEventListener('shown.bs.tab', () => {
                if (map) map.invalidateSize();
            });
        });
    </script>
</body>
</html>